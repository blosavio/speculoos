<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>speculoos.utility documentation</title><link rel="stylesheet" type="text/css" href="default.css" /><link rel="stylesheet" type="text/css" href="highlight.css" /><script type="text/javascript" src="highlight.min.js"></script><script type="text/javascript" src="jquery.min.js"></script><script type="text/javascript" src="page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Speculoos</span> <span class="project-version">version 2-SNAPSHOT1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1"><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>speculoos</span></div></div></li><li class="depth-2 branch"><a href="speculoos.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="speculoos.function-specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>function-specs</span></div></a></li><li class="depth-2 current"><a href="speculoos.utility.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utility</span></div></a></li></ul><ul class="index-link"><li class="depth-1"><a href="https://github.com/blosavio/speculoos">Project Home</a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="speculoos.utility.html#var-*ordinal-offset*"><div class="inner"><span>*ordinal-offset*</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-*such-that-max-tries*"><div class="inner"><span>*such-that-max-tries*</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D10th"><div class="inner"><span>=10th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D11th"><div class="inner"><span>=11th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D12th"><div class="inner"><span>=12th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D1st"><div class="inner"><span>=1st</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D2nd"><div class="inner"><span>=2nd</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D3rd"><div class="inner"><span>=3rd</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D4th"><div class="inner"><span>=4th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D5th"><div class="inner"><span>=5th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D6th"><div class="inner"><span>=6th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D7th"><div class="inner"><span>=7th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D8th"><div class="inner"><span>=8th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-.3D9th"><div class="inner"><span>=9th</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-all-specs-okay"><div class="inner"><span>all-specs-okay</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-apathetic"><div class="inner"><span>apathetic</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-basic-collection-spec-from-data"><div class="inner"><span>basic-collection-spec-from-data</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-clamp-every"><div class="inner"><span>clamp-every</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-clamp-in*"><div class="inner"><span>clamp-in*</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-collections-without-predicates"><div class="inner"><span>collections-without-predicates</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-data-from-spec"><div class="inner"><span>data-from-spec</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-defpred"><div class="inner"><span>defpred</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-exercise"><div class="inner"><span>exercise</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-in.3F"><div class="inner"><span>in?</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-inspect-fn"><div class="inner"><span>inspect-fn</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-lazy-seq.3F"><div class="inner"><span>lazy-seq?</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-non-predicates"><div class="inner"><span>non-predicates</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-pred-sym-.3Egen-sym"><div class="inner"><span>pred-sym-&gt;gen-sym</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-predicate-.3Egenerator"><div class="inner"><span>predicate-&gt;generator</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-predicates-without-collections"><div class="inner"><span>predicates-without-collections</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-predicates-without-scalars"><div class="inner"><span>predicates-without-scalars</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-scalars-with-predicates"><div class="inner"><span>scalars-with-predicates</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-scalars-without-predicates"><div class="inner"><span>scalars-without-predicates</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-seq-regex"><div class="inner"><span>seq-regex</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-sore-thumb"><div class="inner"><span>sore-thumb</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-spec-from-data"><div class="inner"><span>spec-from-data</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-swap-non-predicates"><div class="inner"><span>swap-non-predicates</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-thoroughly-valid-collections.3F"><div class="inner"><span>thoroughly-valid-collections?</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-thoroughly-valid-scalars.3F"><div class="inner"><span>thoroughly-valid-scalars?</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-thoroughly-valid.3F"><div class="inner"><span>thoroughly-valid?</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-unfindable-generators"><div class="inner"><span>unfindable-generators</span></div></a></li><li class="depth-1"><a href="speculoos.utility.html#var-validate-predicate-.3Egenerator"><div class="inner"><span>validate-predicate-&gt;generator</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">speculoos.utility</h1><div class="doc"><div class="markdown"><p>Utility functions to make using and interacting with Speculoos nicer.</p>
<ol>
<li>
<p><strong>Constructive</strong> functions create conforming data or specifications, e.g., synthesizing valid data when given a specification.</p>
<ul>
<li><a href="speculoos.utility.html#var-data-from-spec">data-from-spec</a></li>
<li><a href="speculoos.utility.html#var-spec-from-data">spec-from-data</a></li>
<li><a href="speculoos.utility.html#var-exercise">exercise</a></li>
<li><a href="speculoos.utility.html#var-basic-collection-spec-from-data">basic-collection-spec-from-data</a></li>
</ul>
</li>
<li>
<p>“<strong>Destructive</strong>” functions return new versions of data and/or specification with non-conforming datums or un-satisfied predicates altered or removed so that validation fully succeeds, e.g., replacing all invalid pairs with <code>nil</code>/<code>nil?</code>.</p>
<ul>
<li><a href="speculoos.utility.html#var-apathetic">apathetic</a></li>
<li><a href="speculoos.utility.html#var-swap-non-predicates">swap-non-predicates</a></li>
</ul>
<p>All data structures remain immutable. These functions are only “destructive” in the sense that if you forward the new version of data and/or specification, the recipient will have lost some information.</p>
</li>
<li>
<p><strong>Reporting</strong> functions highlight some aspect of a data set or specification, e.g., returning non-predicates within a specification.</p>
<ul>
<li><a href="speculoos.utility.html#var-thoroughly-valid-scalars.3F">thoroughly-valid-scalars?</a></li>
<li><a href="speculoos.utility.html#var-thoroughly-valid-collections.3F">thoroughly-valid-collections?</a></li>
<li><a href="speculoos.utility.html#var-thoroughly-valid.3F">thoroughly-valid?</a></li>
<li><a href="speculoos.utility.html#var-all-specs-okay">all-specs-okay</a></li>
<li><a href="speculoos.utility.html#var-scalars-without-predicates">scalars-without-predicates</a></li>
<li><a href="speculoos.utility.html#var-scalars-with-predicates">scalars-with-predicates</a></li>
<li><a href="speculoos.utility.html#var-collections-without-predicates">collections-without-predicates</a></li>
<li><a href="speculoos.utility.html#var-non-predicates">non-predicates</a></li>
<li><a href="speculoos.utility.html#var-sore-thumb">sore-thumb</a></li>
<li><a href="speculoos.utility.html#var-predicates-without-scalars">predicates-without-scalars</a></li>
<li><a href="speculoos.utility.html#var-unfindable-generators">unfindable-generators</a></li>
<li><a href="speculoos.utility.html#var-validate-predicate-.3Egenerator">validate-predicate-&gt;generator</a></li>
</ul>
</li>
<li>
<p><strong>Helper</strong> functions decrease keypresses, e.g., <em>get fourth element of a sequence</em>.</p>
<ul>
<li><a href="speculoos.utility.html#var-.3D1st">=1st</a> through <a href="speculoos.utility.html#var-.3D12th">=12th</a></li>
<li><a href="speculoos.utility.html#var-clamp-in*">clamp-in*</a> and <a href="speculoos.utility.html#var-clamp-every">clamp-every</a></li>
<li><a href="speculoos.utility.html#var-defpred">defpred</a></li>
<li><a href="speculoos.utility.html#var-in.3F">in?</a></li>
<li><a href="speculoos.utility.html#var-lazy-seq.3F">lazy-seq?</a></li>
<li><a href="speculoos.utility.html#var-seq-regex">seq-regex</a></li>
</ul>
</li>
</ol>
</div></div><div class="public anchor" id="var-*ordinal-offset*"><h3>*ordinal-offset*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Governs behavior of <a href="speculoos.utility.html#var-.3D1st">=1st</a>, <a href="speculoos.utility.html#var-.3D2nd">=2nd</a>, through <a href="speculoos.utility.html#var-.3D12th">=12th</a>. Bind to <code>-1</code> (default) for one-based indexing. Bind to <code>0</code> for zero-based indexing.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1272">view source</a></div></div><div class="public anchor" id="var-*such-that-max-tries*"><h3>*such-that-max-tries*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1403">view source</a></div></div><div class="public anchor" id="var-.3D10th"><h3>=10th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1337">view source</a></div></div><div class="public anchor" id="var-.3D11th"><h3>=11th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1338">view source</a></div></div><div class="public anchor" id="var-.3D12th"><h3>=12th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1339">view source</a></div></div><div class="public anchor" id="var-.3D1st"><h3>=1st</h3><div class="usage"></div><div class="doc"><div class="markdown"><p><code>(=1st s)</code> <br /> <code>(=2nd s)</code> <br /> <code>(=3rd s)</code> <br /> <code>(=4th s)</code> <br /> <code>(=5th s)</code> <br /> <code>(=6th s)</code> <br /> <code>(=7th s)</code> <br /> <code>(=8th s)</code> <br /> <code>(=9th s)</code> <br /> <code>(=10th s)</code> <br /> <code>(=11th s)</code> <br /> <code>(=12th s)</code></p>
<p>Convenience functions to access elements of a sequence <code>s</code>. Uses one-based indexing by default.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(=1st [:one :two :three]) ;; =&gt; :one
(=2nd [:one :two :three]) ;; =&gt; :two
(=3rd [:one :two :three]) ;; =&gt; :three

(=2nd (list 'foo 'bar 'baz)) ;; =&gt; bar
</code></pre>
<p>Re-bind <a href="speculoos.utility.html#var-*ordinal-offset*">*ordinal-offset*</a> for zero-based indexing.</p>
<p>Example:</p>
<pre><code class="language-clojure">(binding [*ordinal-offset* 0]
    (=1st [:one :two :three])) ;; =&gt; :two
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1328">view source</a></div></div><div class="public anchor" id="var-.3D2nd"><h3>=2nd</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1329">view source</a></div></div><div class="public anchor" id="var-.3D3rd"><h3>=3rd</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1330">view source</a></div></div><div class="public anchor" id="var-.3D4th"><h3>=4th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1331">view source</a></div></div><div class="public anchor" id="var-.3D5th"><h3>=5th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1332">view source</a></div></div><div class="public anchor" id="var-.3D6th"><h3>=6th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1333">view source</a></div></div><div class="public anchor" id="var-.3D7th"><h3>=7th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1334">view source</a></div></div><div class="public anchor" id="var-.3D8th"><h3>=8th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1335">view source</a></div></div><div class="public anchor" id="var-.3D9th"><h3>=9th</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="speculoos.utility.html#var-.3D1st">=1st</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1336">view source</a></div></div><div class="public anchor" id="var-all-specs-okay"><h3>all-specs-okay</h3><div class="usage"><code>(all-specs-okay spec)</code></div><div class="doc"><div class="markdown"><p>Returns <code>true</code> if all entries in specification <code>spec</code> are a function. Otherwise, returns <a href="speculoos.core.html#var-all-paths">all-paths</a> entries <code>{:path _ :element _}</code> to non-functions. See <a href="speculoos.utility.html#var-non-predicates">non-predicates</a> for limitations.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(all-specs-okay [int? keyword? ratio?]) ;; =&gt; true
(all-specs-okay [int? keyword? 9.87]) ;; =&gt; ({:path [2], :value 9.87})
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L263">view source</a></div></div><div class="public anchor" id="var-apathetic"><h3>apathetic</h3><div class="usage"><code>(apathetic data spec)</code></div><div class="doc"><div class="markdown"><p>Return a scalar specification <code>spec</code> for which any specification predicate which returns invalid, is transmorgrified to <code>any?</code>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(apathetic [42 :foo 22/7] [int? symbol? ratio?]) ;; =&gt; [int? any? ratio?]
(apathetic {:a 42 :b 'foo} {:a int? :b keyword?}) ;; =&gt; {:a int?, :b any?}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L328">view source</a></div></div><div class="public anchor" id="var-basic-collection-spec-from-data"><h3>basic-collection-spec-from-data</h3><div class="usage"><code>(basic-collection-spec-from-data data)</code></div><div class="doc"><div class="markdown"><p>Given <code>data</code>, a heterogeneous, arbitrarily-nested collection, returns a similar structure that can serve as basic collection specification. Non-terminating sequences are clamped to length <code>3</code> and converted to vectors.</p>
<p>Note: Speculoos validates maps with predicates at keys which do not exist in <code>data</code>, so a pseudo-qualified key <code>:speculoos.utility/collection-predicate</code> is created that is applied by <a href="speculoos.core.html#var-validate-collections">validate-collections</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(basic-collection-spec-from-data [42 [:foo [22/7]]])
;; =&gt; [[[vector?] vector] vector?]

(basic-collection-spec-from-data {:a 42 :b {:c ['foo true]}})
;; =&gt; {:b {:c [vector?], :speculoos.utility/collection-predicate map?},
;;     :speculoos.utility/collection-predicate map?}

(basic-collection-spec-from-data [42 #{:foo} (list 22/7) (range)])
;; =&gt; [#{set?} (list?) [vector] vector]
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L878">view source</a></div></div><div class="public anchor" id="var-clamp-every"><h3>clamp-every</h3><div class="usage"><code>(clamp-every coll x)</code></div><div class="doc"><div class="markdown"><p>Given a heterogeneous, arbitrarily-nested collection <code>coll</code>, ‘clamp’ every (possibly) non-terminating sequence at length <code>x</code>. Sequences are converted to vectors. See <a href="speculoos.utility.html#var-clamp-in*">clamp-in*</a> for particulars on behavior.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(clamp-every [42 (range) 99 (repeat :foo) 33] 3)
;; =&gt; [42 [0 1 2] 99 [:foo :foo :foo] 33]

(clamp-every {:a (cycle ['foo 'bar 'baz]) :b (iterate inc 100)} 5)
;; =&gt; {:a [foo bar baz foo bar], :b [100 101 102 103 104]}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1100">view source</a></div></div><div class="public anchor" id="var-clamp-in*"><h3>clamp-in*</h3><div class="usage"><code>(clamp-in* coll path x)</code></div><div class="doc"><div class="markdown"><p>Given a heterogeneous, arbitrarily-nested collection <code>coll</code>, ‘clamp’ (possibly) non-terminating sequence at <code>path</code> to length <code>x</code>. Sequences are converted to vectors.</p>
<p>Beware: Behaves like <code>take</code>, so will also possibly shorten vectors, lists, sets, and maps if located at <code>path</code>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(clamp-in* [:foo (range) 'bar] [1] 3)
;; =&gt; [:foo [0 1 2] bar]

(clamp-in* {:a [42 'foo {:b (cycle [:x :y :z])}]} [:a 2 :b] 5)
;; =&gt; {:a [42 foo {:b [:x :y :z :x :y]}]}

;; does not discriminate; operates on terminating sequences, too
(clamp-in* [:foo 42 [:x :y :z :a :b :c]] [2] 4)
;; =&gt; [:foo 42 [:x :y :z :a]]

;; sequences that are shorter than `x` are unchanged
(clamp-in* {:a (take 3 (range))} [:a] 6)
;; =&gt; {:a [0 1 2]}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1068">view source</a></div></div><div class="public anchor" id="var-collections-without-predicates"><h3>collections-without-predicates</h3><div class="usage"><code>(collections-without-predicates data spec)</code></div><div class="doc"><div class="markdown"><p>Given <code>data</code> a heterogeneous, arbitrarily-nested data structure, returns a set of <code>data</code>’s all-paths elements for collections which lack at least one corresponding predicate in collection specification <code>spec</code>. See also <a href="speculoos.utility.html#var-scalars-without-predicates">scalars-without-predicates</a> and <a href="speculoos.utility.html#var-scalars-with-predicates">scalars-with-predicates</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; all collections have a corresponding collection predicate; returns an empty set
(collections-without-predicates [11 [22] 33] [vector? [vector?]])
;; =&gt; #{}

;; missing predicate(s)
(collections-without-predicates [11 [22] 33] [vector? []])
;; =&gt; #{{:path [1], :value [22]}}

(collections-without-predicates {:a [11 {:b (list 22 33)}]} {:a [vector? {:is-a-map? map?}]})
;; =&gt; #{{:path [:a 1 :b], :value (22 33)}
;;      {:path [], :value {:a [11 {:b (22 33)}]}}}

(collections-without-predicates [11 [22] 33 (cycle [44 55 66])] [vector? [vector?]])
;; =&gt; #{{:path [3], :value []}}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L906">view source</a></div></div><div class="public anchor" id="var-data-from-spec"><h3>data-from-spec</h3><div class="usage"><code>(data-from-spec spec)</code><code>(data-from-spec spec opt)</code></div><div class="doc"><div class="markdown"><p>Given heterogeneous, arbitrarily-nested scalar specification <code>spec</code>, create a sample data structure whose values validate to that specification. Only works for singular, clojure.core predicates, e.g., <code>int?</code>, <code>string?</code>. Does not work for something like <code>#(and (int? %) (&lt; 5 %))</code>. Unknown predicates yield <code>nil</code>. Defaults to canonical values, i.e., <code>'abc'</code> for <code>string?</code>.</p>
<p>Optional trailing arg <code>:random</code> uses <code>clojure.test.check</code> generators when available. Trailing arg <code>:canonical</code> (default) uses lookup table to supply aesthetic values, i.e., <code>42</code> for <code>int?</code>.</p>
<p>Sets are assumed to be a predicate. <code>:canonical</code> uses whatever <code>clojure.core/first</code> returns (consider a sorted set with the first element an exemplar); <code>:random</code> yields a random selection from the set.</p>
<p>Bare regular expressions yield random strings that match.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; default canonical datums
(data-from-spec [int? keyword? ratio?]) ;; =&gt; [42 :kw 22/7]
(data-from-spec {:a symbol? :b decimal?}) ;; =&gt; {:a speculoos/canonical-symbol, :b 1M}

;; optional random values
(data-from-spec [int? [keyword? [ratio?]]] :random) ;; =&gt; [-715 [:! [15/2]]]
(data-from-spec {:a symbol? :b {:c boolean? :d pos-int?}} :random) ;; =&gt; {:a x2_qV/x, :b {:c true, :d 26}}

;; set as a predicate, defaults to (first #{...})
(data-from-spec [int? #{:red :green :blue} ratio?]) ;; =&gt; [42 :green 22/7]

;; set as a predicate, optional random selection
(data-from-spec [int? #{:red :green :blue} ratio?] :random) ;; =&gt; [-208 :red 7/2]

;; regular expression as a predicate
(data-from-spec [#"Q\d{3}Y\d{1,2}" #"foo[2468]"])
;; =&gt; ["Q690Y61" "foo6"]
</code></pre>
<p>If the metadata of a non-set, non-regex predicate contains either key <code>:speculoos/predicate-&gt;generator</code> or key <code>:speculoos/canonical-sample</code>, the associated value is presumed to be a competent generator or canonical sample, respectively, and will be preferred. See <a href="speculoos.utility.html#var-validate-predicate-.3Egenerator">validate-predicate-&gt;generator</a>.</p>
<p>Note: Presence of either metadata key implies that a default generator will not be found in the lookup table, and therefore requires a customized generator for invoking with the <code>:random</code> option. But it <em>also</em> implies that a canonical value will also not be located, and therefore requires a custom canonical value, which is referenced when explicitly invoked with <code>:canonical</code>, <em>but also the default, no-option invocation</em>.</p>
<pre><code class="language-clojure">;; as is, Speculoos cannot generate a sample datum from this predicate
(def opaque-predicate (fn [x] (and (int? x) (pos? x) (&lt; x 99))))

;; Speculoos can however retrieve a generator at metadata key :speculoos/predicate-&gt;generator
(data-from-spec {:a string? :b (with-meta opaque-predicate {:speculoos/predicate-&gt;generator #(rand-int 100)})} :random)
;; =&gt; {:a "Q56BPs2ownU08ExMOy3yVD37M6Q", :b 15}

;; predicates not found in the lookup table must explicitly provide a canonical value when invoking without `opt`
(data-from-spec [ratio? (with-meta int? {:speculoos/canonical-sample 987654321})])
;; =&gt; [22/7 987654321]
</code></pre>
<p>See <a href="speculoos.utility.html#var-defpred">defpred</a> for a helper to set up a predicate with a generator.</p>
<pre><code class="language-clojure">(defpred f4 int? #(rand-int 99)) ;; optional canonical value not supplied
(defpred f5 number? #(rand 999) 1.234)

(data-from-spec {:a f4 :b [f5]} :random)
;; =&gt; {:a 31, :b [147.28249222486664]}

(data-from-spec {:a f4 :b [f5]} :canonical)
;; =&gt; {:a :f4-canonical-sample, :b [1.234]}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L528">view source</a></div></div><div class="public anchor" id="var-defpred"><h3>defpred</h3><h4 class="type">macro</h4><div class="usage"><code>(defpred predname f)</code><code>(defpred predname f generator)</code><code>(defpred predname f generator canonical)</code></div><div class="doc"><div class="markdown"><p><em>def</em>ine a <em>pred</em>icate by binding symbol <code>predname</code> to function <code>f</code> while associating a random sample generator.</p>
<ol>
<li>With only a name <code>predname</code> and function <code>f</code>, <code>defpred</code> will attempt to create a random sample generator as outlined by <a href="speculoos.utility.html#var-inspect-fn">inspect-fn</a>.</li>
<li>An explicitly supplied <code>generator</code> will be preferred.</li>
<li>If <code>generator</code> is explicitly provided, a canonical value may also be supplied. If the optional canonical value is not supplied, a keyword is automatically generated using the symbol <code>predname</code> appended with <code>-canonical-sample</code>.</li>
</ol>
<p>Useful for defining predicates consumed by <a href="speculoos.utility.html#var-data-from-spec">data-from-spec</a>, <a href="speculoos.utility.html#var-exercise">exercise</a>, and friends.</p>
<p><code>*such-that-max-tries*</code> is bound to an integer (default <code>50</code>) that governs the number of attempts the random sample generator will make to create a valid sample.</p>
<p>Note: Can not use bare predicates such as <code>int?</code>; they must be ‘wrapped’, like <code>#(int? %)</code>. See examples.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(macroexpand-1 '(defpred foo (fn [i] (int? i)) (fn [] (rand-int 99)) 42))
;; =&gt; (def foo (clojure.core/with-meta (fn [i] (int? i)) #:speculoos{:canonical-sample 42, :predicate-&gt;generator (fn [] (rand-int 99))}))

(defpred f1 #(&lt;= % 99) #(rand-int 99) 42)
(defpred f2 #(&lt;= % 5)  #(- (rand-int 99))) ;; no canonical value supplied
(defpred f3 #(&gt; % 999) #(rand 999) 1.23)

(data-from-spec [f1 f2 f3] :random)
;; =&gt; [86 -77 971.3462532541377]

(data-from-spec [f1 f2 f3] :canonical)
;; =&gt; [42 :f2-canonical-sample 1.23]

;; using (and...) to modify a core predicate
(defpred even-int? #(and (int? %) (even? %) (&lt; 3 %)))
(data-from-spec [even-int? even-int? even-int? even-int?] :random)
;; =&gt; [14 24 16 30]

;; using (or...) to generate alternatives
(defpred int-or-kw? #(or (int? %) (keyword? %)))
(data-from-spec [int-or-kw? int-or-kw? int-or-kw? int-or-kw?] :random)
;; =&gt; [:J0+ -25 22 :o_6W.l:?]

;; using both (and...) and (or...)
(defpred odd-int-or-short-kw? (fn [x] (or (and (int? x)
                                               (odd? x))
                                          (and (keyword? x)
                                               (&gt;= 3 (count (str x)))))))

(data-from-spec [odd-int-or-short-kw?
                 odd-int-or-short-kw?
                 odd-int-or-short-kw?
                 odd-int-or-short-kw?] :random)
;; =&gt; [:Y9.c :i. -3 :xxk]
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1703">view source</a></div></div><div class="public anchor" id="var-exercise"><h3>exercise</h3><div class="usage"><code>(exercise spec)</code><code>(exercise spec n)</code></div><div class="doc"><div class="markdown"><p>Generates a number <code>n</code> (default 10) of values compatible with scalar specification <code>spec</code> and maps <a href="speculoos.core.html#var-valid-scalars.3F">valid-scalars?</a> over them, returning a sequence of <code>[val valid?]</code> tuples.</p>
<p>See <a href="speculoos.utility.html#var-data-from-spec">data-from-spec</a> for details on predicates.</p>
<p>Examples, passing optional count <code>n</code> <code>3</code> for brevity:</p>
<pre><code class="language-clojure">(exercise [int? [keyword? ratio?] char?] 3)
;; =&gt; ([[-282 [:_1z9L -17/21] \G] true]
;;     [[ 469 [:c*2y   -7/11] \9 true]
;;     [[-293 [:*C     -3/7 ] \i] true])

(exercise {:a symbol? :b [pos-int? decimal? char?]} 3)
;; =&gt; ([{:a U8D_/gs+H,   :b [17 1M \Z]} true]
;;     [{:a b-187+/Xv,   :b [27 1M \3]} true]
;;     [{:a ?l4zv/Y.Ro!, :b [22 1M \G]} true])
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L740">view source</a></div></div><div class="public anchor" id="var-in.3F"><h3>in?</h3><div class="usage"><code>(in? coll item)</code></div><div class="doc"><div class="markdown"><p>Returns <code>true</code> if <code>item</code> is found somewhere in collection <code>coll</code>. This utility function is a replacement for what the name <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/contains?"><code>clojure.core/contains?</code></a> suggests it might do. Works on all collection types, but map elements are checked as <code>MapEntry</code> key-value pairs. Pass <code>(vals m)</code> if you want to only check values. Properly handles <code>nil</code> and <code>false</code> membership.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; `contains?` tests for existence of a sequence's index, not its values
(contains? [:a :b :c] 1) ;; =&gt; true

;; `in?` tests for existence of a sequence's values
(in? [:a :b :c] 1) ;; =&gt; false

(in? [:a :b :c] :b) ;; true
(in? (list 'foo 'bar 'baz) 'foo) ;; =&gt; true
(in? #{:red :green :blue} :green) ;; =&gt; true
(in? (range) 3) ;; =&gt; true

;; elements of a map are tested as MapEntries
(in? {:a 1 :b 2 :c 3} 3) ;; =&gt; false

;; passing just the vals of a map
(in? (vals {:a 1 :b 2 :c 3}) 3) ;; =&gt; true

;; testing existence of a MapEntry
(in? {:a 1 :b 2 :c 3} [:c 3]) ;; =&gt; true

;; nil presence
(in? [42 nil 22/7] nil) ;; =&gt; true

;; false presence
(in? (vals {:a 42 :b false}) false) ;; =&gt; true
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1123">view source</a></div></div><div class="public anchor" id="var-inspect-fn"><h3>inspect-fn</h3><div class="usage"><code>(inspect-fn f)</code></div><div class="doc"><div class="markdown"><p>Inspect expression <code>f</code> to attempt to create a random sample generator. If unable to do so, returns <code>nil</code>.<code>f</code> must be of the form <code>(fn [...] ...)</code> or <code>#(...)</code>.</p>
<p><em>This implementation is a proof-of-concept</em> that only descends to a maximum depth of two levels. It does not generically handle arbitrary nesting depths nor all possible Clojure data types</p>
<p>The predicate body must fulfill these properties:</p>
<ol>
<li>The first symbol must be <code>and</code>, <code>or</code>, or a basic predicate for a Clojure built-in scalar, such as <code>int?</code> that is registered at <code>speculoos.utility/preddicate-&gt;generator</code>.</li>
<li>The first clause after <code>and</code> or <code>or</code> must contain a <code>clojure.core</code> predicate for a scalar, such as <code>int?</code>.</li>
<li>Subsequent clauses of <code>and</code> will be injected into a <code>clojure.test.check.generators/such-that</code> filter.</li>
<li>Direct descendants of a top-level <code>or</code> will produce <code>n</code> separate random sample generators, each with <code>1/n</code> probability for any one invocation.</li>
</ol>
<p>Examples:</p>
<pre><code class="language-clojure">(inspect-fn '(fn [i] (int? i)))
(inspect-fn '(fn [i] (and (int? i) (even? i))))

(inspect-fn '#(int? %))
(inspect-fn '#(and (int? %) (even? %)))

(inspect-fn '(fn [x] (or (int? x) (ratio? x))))

(inspect-fn '#(or (and (int? %) (odd? %))
                  (and (string? %) (&lt;= 3 (count %)))))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1507">view source</a></div></div><div class="public anchor" id="var-lazy-seq.3F"><h3>lazy-seq?</h3><div class="usage"><code>(lazy-seq? x)</code></div><div class="doc"><div class="markdown"><p>Returns <code>true</code> if <code>x</code> is a lazy sequence.</p>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1816">view source</a></div></div><div class="public anchor" id="var-non-predicates"><h3>non-predicates</h3><div class="usage"><code>(non-predicates spec)</code></div><div class="doc"><div class="markdown"><p>Returns <a href="speculoos.core.html#var-all-paths">all-paths</a> entries <code>{:path _ :value _}</code> for all elements in specification <code>spec</code> that are not functions.</p>
<p>This function name is possibly mis-leading: It tests only <code>fn?</code>, not if the function is a competent predicate. Sets are flagged as ‘non-predicates’.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(non-predicates [int? 42 decimal?]) ;; =&gt; ({:path [1], :value 42})

(non-predicates {:a int? :b 'foo}) ;; =&gt; ({:path [:b], :value foo})
</code></pre>
<p>Sets may serve as a membership predicate for a scalar specification, but are flagged as ‘non-predicates’.</p>
<p>Demonstration:</p>
<pre><code class="language-clojure">;; `validate-scalars` considers #{:red} as a predicate-like thing, but ...
;; ... `non-predicates` is unable to distinguish without data to accompany spec
(non-predicates [int? #{:red} ratio?]) ;; =&gt; ({:path [1 :red], :value :red})
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L235">view source</a></div></div><div class="public anchor" id="var-pred-sym-.3Egen-sym"><h3>pred-sym-&gt;gen-sym</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1346">view source</a></div></div><div class="public anchor" id="var-predicate-.3Egenerator"><h3>predicate-&gt;generator</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1394">view source</a></div></div><div class="public anchor" id="var-predicates-without-collections"><h3>predicates-without-collections</h3><div class="usage"><code>(predicates-without-collections data spec)</code></div><div class="doc"><div class="markdown"><p>Given <code>data</code> at heterogeneuous, arbitrarily-nested data structure and a collection specification <code>spec</code>, returns a set of all-paths elements for predicates in <code>spec</code> which cannnot be paired with a collection element in <code>data</code>. See also <a href="speculoos.utility.html#var-collections-without-predicates">collections-without-predicates</a>, <a href="speculoos.utility.html#var-scalars-without-predicates">scalars-without-predicates</a>, and <a href="speculoos.utility.html#var-predicates-without-scalars">predicates-without-scalars</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; all predicates are paired
(predicates-without-collections [42] [vector?])
;; =&gt; #{}

;; one un-paired predicate
(predicates-without-collections [42] [vector? [map?]])
;; =&gt; #{{:path [1 0], :value map?}}

;; one un-paired predicate
(predicates-without-collections {:a 42} {:is-map? map? :b [vector?]})
;; =&gt; #{{:path [:b 0], :value vector?}}

;; one un-paired predicate &lt;-- collection validation only applies predicates to non-scalars
(predicates-without-collections {:a 42 :b 99} {:is-map? map? :b [vector?]})
;; =&gt; #{{:path [:b 0], :value vector?}}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L941">view source</a></div></div><div class="public anchor" id="var-predicates-without-scalars"><h3>predicates-without-scalars</h3><div class="usage"><code>(predicates-without-scalars data spec)</code></div><div class="doc"><div class="markdown"><p>Returns only scalar specification <code>spec</code> elements which lack a corresponding element in <code>data</code>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(predicates-without-scalars [42 :foo] [int? keyword? ratio?]) ;; =&gt; ({:path [2], :value ratio?})
(predicates-without-scalars {:a 42} {:a int? :b symbol?}) ;; =&gt; ({:path [:b], :value symbol?})
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L216">view source</a></div></div><div class="public anchor" id="var-scalars-with-predicates"><h3>scalars-with-predicates</h3><div class="usage"><code>(scalars-with-predicates data spec)</code></div><div class="doc"><div class="markdown"><p>Returns <code>data</code> all-paths scalar elements which have a corresponding predicate in scalar specification <code>spec</code>. See also <a href="speculoos.utility.html#var-scalars-without-predicates">scalars-without-predicates</a> and <a href="speculoos.utility.html#var-collections-without-predicates">collections-without-predicates</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(scalars-with-predicates [42 :foo 22/7] [int?]) ;; =&gt; ({:path [0], :value 42})
(scalars-with-predicates {:a 42 :b 'foo} {:a int?}) ;; =&gt; ({:path [:a], :value 42})
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L195">view source</a></div></div><div class="public anchor" id="var-scalars-without-predicates"><h3>scalars-without-predicates</h3><div class="usage"><code>(scalars-without-predicates data spec)</code></div><div class="doc"><div class="markdown"><p>Returns a set of <code>data</code> all-paths scalar elements which lack corresponding predicates in scalar specification <code>spec</code>. See also <a href="speculoos.utility.html#var-scalars-with-predicates">scalars-with-predicates</a> and <a href="speculoos.utility.html#var-collections-without-predicates">collections-without-predicates</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(scalars-without-predicates [42 :foo 22/7] [int? keyword?]) ;; =&gt; #{{:path [2], :value 22/7}}
(scalars-without-predicates {:a 42 :b 'foo} {:a int?}) ;; =&gt; #{{:path [:b], :value foo}}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L174">view source</a></div></div><div class="public anchor" id="var-seq-regex"><h3>seq-regex</h3><div class="usage"><code>(seq-regex s &amp; pred-regexes)</code></div><div class="doc"><div class="markdown"><p>Returns <code>true</code> if sequence <code>s</code> fully satisfies <code>pred-regex</code>, pairs of predicates and regex-like operators. Predicates partition the sequence, regex operators check the quantity, according to the following.</p>
<ul>
<li><code>:?</code> zero-or-one</li>
<li><code>:.</code> exactly-one</li>
<li><code>:+</code> one-or-more</li>
<li><code>:*</code> zero-or-more</li>
<li><code>[m n]</code> between <code>m</code> and <code>n</code> (integers), inclusive</li>
<li><code>i</code> exactly <code>i</code> (integer)</li>
</ul>
<p>Examples:</p>
<pre><code class="language-clojure">(seq-regex [1 2 3 :a :b 'foo] int? :* keyword? :+ symbol? :.) ;; =&gt; true
</code></pre>
<p>Tests <em>zero-or-more integers, followed by one-or-more keywords, followed by exactly-one symbol</em>.</p>
<p>You must supply predicate and regexes to exhaust the sequence, otherwise returns <code>false</code>. If you don’t care about entities beyond a particular index, use the duplet <code>any? :*</code>.</p>
<pre><code class="language-clojure">(seq-regex [1 2 :a :b true false] int? 2 keyword? [1 3] any? :*) ;; =&gt; true
</code></pre>
<p>Tests <em>exactly two integers, followed by one to three keywords, followed by any number of anything</em>.</p>
<p>Failing example:</p>
<pre><code class="language-clojure">(seq-regex [1 2 :a :b] int? 2) ;; =&gt; false
</code></pre>
<p>Tests <em>exactly two integers</em>; example fails because trailing keywords are not matched.</p>
<p>Any unused pred-regex pairs are ignored.</p>
<pre><code class="language-clojure">(seq-regex [1 2 3] int? 3 keyword? 3) ;; =&gt; true
</code></pre>
<p>If your first regex is <em>zero-or-more</em> <code>:*</code>, then it will match an empty sequence, regardless of any trailing pred-regex pairs.</p>
<pre><code class="language-clojure">(seq-regex [] int? :* keyword :+) ;; =&gt; true
</code></pre>
<p>Do not stack the <em>one-or-more</em> <code>:.</code> regex operator in an attempt to get an integer <code>&gt;1</code>.</p>
<pre><code class="language-clojure">(seq-regex [1 2 3] int? :. int? :. int? :.) ;; =&gt; false
</code></pre>
<p>Instead, use the <em>exactly-integer</em> or the range ops.</p>
<pre><code class="language-clojure">(seq-regex [1 2 3] int? 3) ;; =&gt; true
(seq-regex [1 2 3] int? [1 4]) ;; =&gt; true
</code></pre>
<p>Predicates must be specific enough so that they aren’t consumed further than you intend. This is treacherous when, e.g., converting to string. Here’s possibly surprising failing example:</p>
<pre><code class="language-clojure">(seq-regex [:a :b :c 'fo 'br 'bz] #(= 2 (count (str %))) 3 symbol? 3)
;; =&gt; false
</code></pre>
<p><code>'fo</code>, <code>'br</code>, and <code>'bz</code> all satisfy <code>length=2</code> when converted to string, leaving <code>symbol?</code> no values to test. Instead, insert a guarding predicate.</p>
<pre><code class="language-clojure">(seq-regex [:a :b :c 'fo 'br 'bz] #(and (keyword? %)
                                        (= 2 (count (str %)))) 3 symbol? 3)
;; =&gt; true
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1164">view source</a></div></div><div class="public anchor" id="var-sore-thumb"><h3>sore-thumb</h3><div class="usage"><code>(sore-thumb data spec)</code><code>(sore-thumb data spec replacement)</code></div><div class="doc"><div class="markdown"><p>Prints <code>*out*</code> a version of <code>data</code> and <code>spec</code> that highlights where the datums+predicates invalidate. Non-invalids (i.e., datums that satisfy their own predicates) are de-emphasized with <code>replacement</code>, defaulting to <code>'_</code>.</p>
<p><code>'…</code> is also kinda nice.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; default replacement '_
(with-out-str (sore-thumb [42 :foo 22/7] [int? symbol? ratio?]))
;; printed to *out*: data: [_ :foo _] spec: [_ symbol? _]

;; optional replacement '…
(with-out-str (sore-thumb {:a 42 :b 'foo :c 22/7} {:a int? :b keyword? :c ratio?} '…))
;; printed to *out*: data: {:a …, :b foo, :c …} spec: {:a …, :b keyword?, :c …}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L345">view source</a></div></div><div class="public anchor" id="var-spec-from-data"><h3>spec-from-data</h3><div class="usage"><code>(spec-from-data data)</code><code>(spec-from-data data clamp-at)</code></div><div class="doc"><div class="markdown"><p>Given heterogeneous, arbitrarily-nested collection <code>data</code>, create a scalar specification whose predicates validate. Non-terminating sequences are clamped at <code>clamp-at</code>, defaults to 7.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(spec-from-data [42 [:foo] 22/7]) ;; =&gt; [int? [keyword?] ratio?]
(spec-from-data {:a 42 :b {:c 'foo :d 22/7}}) ;; =&gt; {:a int?, :b {:c symbol?, :d ratio?}}

;; non-terminating data sequence, optional clamp-at supplied
(spec-from-data [:foo (cycle [42 22/7 'baz])] 5) ;; =&gt; [keyword? [int? ratio? symbol? int? ratio?]]
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L506">view source</a></div></div><div class="public anchor" id="var-swap-non-predicates"><h3>swap-non-predicates</h3><div class="usage"><code>(swap-non-predicates spec)</code><code>(swap-non-predicates spec pred)</code></div><div class="doc"><div class="markdown"><p>Returns a new scalar specification <code>spec</code> with all non-predicate elements swapped for <a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/any?"><code>any?</code></a> (default) or optional supplied predicate <code>pred</code>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; default predicate replacement
(swap-non-predicates [int? 99 ratio?]) ;; =&gt; [int? any? ratio?]

;; non-default predicate replacement
(swap-non-predicates {:a int? :b 99 :c 'foo} number?) ;; =&gt; {:a int?, :b number?, :c number?}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L306">view source</a></div></div><div class="public anchor" id="var-thoroughly-valid-collections.3F"><h3>thoroughly-valid-collections?</h3><div class="usage"><code>(thoroughly-valid-collections? data spec)</code></div><div class="doc"><div class="markdown"><p>Given a heterogeneous, arbitrarily-nested data structure <code>data</code> and collection specification <code>spec</code>, returns <code>true</code> if every collection contained in <code>data</code> has a corresponding predicate in <code>spec</code>, and every collection satisfies its predicate.</p>
<p>See <a href="speculoos.core.html#var-valid-collections.3F">valid-collections?</a>, <a href="speculoos.utility.html#var-collections-without-predicates">collections-without-predicates</a>, and <a href="speculoos.utility.html#var-thoroughly-valid.3F">thoroughly-valid?</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; all collections have satisfied predicates
(thoroughly-valid-collections? [11 {:x 22/7 :y 'foo}] [vector? {:is-map? map?}])
;; =&gt; true

;; all collections have predicates, but not all satisfied
(thoroughly-valid-collections? [11 {:x 22/7 :y 'foo}] [list? {:is-map? map?}])
;; =&gt; false

;; all predicates satisfied, but one collection is missing a predicate
(thoroughly-valid-collections? [11 {:x 22/7 :y 'foo}] [{:is-map? map?}])
;; =&gt; false
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1006">view source</a></div></div><div class="public anchor" id="var-thoroughly-valid-scalars.3F"><h3>thoroughly-valid-scalars?</h3><div class="usage"><code>(thoroughly-valid-scalars? data spec)</code></div><div class="doc"><div class="markdown"><p>Given a heterogeneous, arbitrarily-nested data structure <code>data</code> and scalar specification <code>spec</code>, returns <code>true</code> if every scalar contained in <code>data</code> has a corresponding predicate in <code>spec</code>, and every scalar satisfies its predicate.</p>
<p>See <a href="speculoos.core.html#var-valid-scalars.3F">valid-scalars?</a>, <a href="speculoos.utility.html#var-scalars-without-predicates">scalars-without-predicates</a>, and <a href="speculoos.utility.html#var-thoroughly-valid.3F">thoroughly-valid?</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; all scalars have satisfied predicates
(thoroughly-valid-scalars? [11 {:x 22/7 :y 'foo}] [int? {:x ratio? :y symbol?}])
;; =&gt; true

;; all scalars have predicates, but not all satisfied
(thoroughly-valid-scalars? [11 {:x 22/7 :y 'foo}] [char? {:x ratio? :y symbol?}])
;; =&gt; false

;; all predicates satisfied, but one scalar is missing a predicate
(thoroughly-valid-scalars? [11 {:x 22/7 :y 'foo}] [int? {:x ratio?}])
;; =&gt; false
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L978">view source</a></div></div><div class="public anchor" id="var-thoroughly-valid.3F"><h3>thoroughly-valid?</h3><div class="usage"><code>(thoroughly-valid? data scalar-spec collection-spec)</code></div><div class="doc"><div class="markdown"><p>Given a heterogeneous, arbitrarily-nested data structure <code>data</code>, returns <code>true</code> if every scalar in <code>data</code> has a predicate in <code>scalar-spec</code> and every collection has at least one predicate in <code>collection-spec</code>, and all predicates are satisfied.</p>
<p>See <a href="speculoos.core.html#var-valid.3F">valid?</a>, <a href="speculoos.utility.html#var-scalars-without-predicates">scalars-without-predicates</a>, and <a href="speculoos.utility.html#var-collections-without-predicates">collections-without-predicates</a>.</p>
<p>Examples:</p>
<pre><code class="language-clojure">;; all scalars and colls have satisfied predicates
(thoroughly-valid? [11 {:x 22/7 :y 'foo}] [int? {:x ratio? :y symbol?}] [vector? {:is-map? map?}])
;; =&gt; true

;; all scalars and colls have predicates, but not all satisfied
(thoroughly-valid? [11 {:x 22/7 :y 'foo}] [char? {:x ratio? :y symbol?}] [vector? {:is-map? map?}])
;; =&gt; false

;; all predicates satisfied, but one scalar is missing a predicate
(thoroughly-valid? [11 {:x 22/7 :y 'foo}] [int? {:x ratio?}] [vector? {:is-map? map?}])
;; =&gt; false

;; all predicates satisfied, but one coll is missing a predicate
(thoroughly-valid? [11 {:x 22/7 :y 'foo}] [int? {:x ratio? :y symbol?}] [{:is-map? map?}])
;; =&gt; false
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L1035">view source</a></div></div><div class="public anchor" id="var-unfindable-generators"><h3>unfindable-generators</h3><div class="usage"><code>(unfindable-generators spec)</code></div><div class="doc"><div class="markdown"><p>Given scalar specification <code>spec</code>, check that a random sample generator can be located for each predicate-like thing within <code>spec</code>. Returns a sequence of any thingy that does not, and a path to its location within <code>spec</code>.</p>
<ul>
<li>Many basic predicates such as <code>int?</code>, <code>string?</code>, <code>ratio?</code>, etc., are provided by <code>clojure.test.check.generators</code>.</li>
<li>Sets and regular expressions are competent generators.</li>
<li>Compound predicates such as <code>#(and (number? %) (&lt; % 99))</code> may be explicitly supplied with a custom generator located within its metadata map at key <code>:speculoos/predicate-&gt;generator</code>.</li>
</ul>
<p>Note: Being able to <em>locate</em> a random sample generator does not imply that it works properly.</p>
<pre><code class="language-clojure">;; all good generators
(unfindable-generators [int? #{:red :green :blue} #"foo" (with-meta #(int? %) {:speculoos/predicate-&gt;generator #(rand-int 99)})])
;; =&gt; []

;; all bad generators
(unfindable-generators {:no-meta-data #(int? %)
                        :no-generator +
                        :improper-key (with-meta #(int? %) {:speculoos/oops #(rand-int 99)})})
;; =&gt; [{:path [:no-meta-data], :value #fn--34610]}
;;     {:path [:no-generator], :value clojure.core/+}
;;     {:path [:improper-key], :value #function[clojure.lang.AFunction/1]]}]
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L695">view source</a></div></div><div class="public anchor" id="var-validate-predicate-.3Egenerator"><h3>validate-predicate-&gt;generator</h3><div class="usage"><code>(validate-predicate-&gt;generator f)</code><code>(validate-predicate-&gt;generator f n)</code></div><div class="doc"><div class="markdown"><p>Repeatedly invoke predicate function <code>f</code>, with sample arguments produced by generator located at key <code>:speculoos/predicate-&gt;generator</code> in the function metadata. <code>n</code> invocations (default <code>7</code>). Returns a sequence of vectors containing the generated value and the result of the validation.</p>
<p>Useful for checking manually-injected generators consulted by <a href="speculoos.utility.html#var-data-from-spec">data-from-spec</a>.</p>
<p>Example:</p>
<pre><code class="language-clojure">;; basic integer predicate and generator
(validate-predicate-&gt;generator (with-meta #(int? %) {:speculoos/predicate-&gt;generator #(rand-int 99)}))
;; =&gt; ([64 true] [84 true] [21 true] [74 true] [88 true] [13 true] [33 true])

;; compound integer predicate with compound integer generator
(require '[clojure.test.check.generators :as gen])

;; positive, even integers, less than one hundred; warm up generator by 25 calls and peeling off last
(def gen-1 #(last (gen/sample (gen/such-that even? (gen/large-integer* {:min 0 :max 99})) 25)))

(validate-predicate-&gt;generator (with-meta #(and (int? %) (pos? %) (even? %) (&lt; % 100)) {:speculoos/predicate-&gt;generator gen-1}))
;; =&gt; ([72 true] [52 true] [2 true] [82 true] [64 true] [56 true] [10 true])

;; same thing, but intentionally wrong generator that produces odd integers
(def incorrect-gen-1 #(last (gen/sample (gen/such-that odd? (gen/large-integer* {:min 0 :max 99})) 25)))

(validate-predicate-&gt;generator (with-meta #(and (int? %) (pos? %) (even? %) (&lt; % 100)) {:speculoos/predicate-&gt;generator incorrect-gen-1}))
;; =&gt; ([61 false] [57 false] [3 false] [97 false] [53 false] [77 false] [63 false])

;; validating regular expression generator: capital Z, followed by one to three digits, followed by a, b, or c
(def re-spec #"Z\d{1,3}[abc]")

;; re-rand generates random strings that satisfy a given regex [https://github.com/weavejester/re-rand]
(require '[re-rand :refer [re-rand]])

(validate-predicate-&gt;generator (with-meta #(boolean (re-matches re-spec %)) {:speculoos/predicate-&gt;generator #(re-rand re-spec)}))
;; (["Z919b" true] ["Z99b" true] ["Z5a" true] ["Z210a" true] ["Z711c" true] ["Z319a" true] ["Z81c" true])
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/blosavio/speculoos/blob/main/src/speculoos/utility.clj#L649">view source</a></div></div></div></body></html>